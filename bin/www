#!/usr/bin/env node
var debug = require('debug')('home');
var app = require('../app');
var fs = require("fs");
var SessionSockets = require('session.socket.io');
var Steps = require("ocsteps") ;
var wwwConfig = require("../config/www.js")

app.set('port', process.env.PORT || wwwConfig.wwwPort);
console.log("server is listening on port "+wwwConfig.wwwConfig);

//var server = app.listen(app.get('port'), function() {
//  debug('Express server listening on port ' + server.address().port);
//});

var server = require("./server.js").server;


var io = require('socket.io')(server);
var sessionSockets = new SessionSockets(io, app.sessionStore, app.cookieParser);



sessionSockets.on('connection', function (err, socket, session) {
    //your regular socket.io code goes here
    //and you can still use your io object

    var positionArrs = [1,2]

    socket.on('position',function(msg){
        for(var i=0;i<positionArrs.length;i++){
            if(positionArrs[i] != parseInt(msg.position)){
                positionArrs.splice(i,1)
            }
        }

        io.emit("adjustPosition",{positionArrs:positionArrs})

        console.log(positionArrs)
    })

    socket.on('disconnect', function(){
        console.log('user disconnected');
    });

    socket.on('writeJson',function(jsonData){

    })

});



//
//io.on('connection',function(socket){
//
//})