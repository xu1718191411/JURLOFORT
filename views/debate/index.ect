<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>討論中</title>


<script   src="https://code.jquery.com/jquery-2.2.3.js"   integrity="sha256-laXWtGydpwqJ8JA+X9x2miwmaiKhn8tVmOVEigRNtP4="   crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>


    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./style2.css">


</head>

<body>

<div class="container">
    <div class="row">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">こんにちわ</a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">討論室<span class="sr-only">(current)</span></a></li>
                        <li><a href="#">テーマ一覧</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">設定<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">中断申請</a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#">システム設定</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="#">投降</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="#">視聴者誘う</a></li>
                            </ul>
                        </li>
                    </ul>


                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>

    </div>

   <div class="row">

       <div class="jumbotron">
           <h2>テーマ:学生が成人したら経済的に独立するべきである</h2>


           <% if @userInformation.position==1 : %>
           <p>あなたの立場:<span id="tachiba" tachiba="1" class="label label-info" style="font-size: 20px;">肯定</span></p>
           <% else : %>
           <p>あなたの立場:<span id="tachiba" tachiba="2" class="label label-success" style="font-size: 20px;">否定</span></p>
           <% end %>



           <p>今の段階:<span id="nowStatus">相手に意見の分析</span></p>
           <p>肯定:<span id="proUsername"></span><span id="proUserStatus">入室</span></p>
           <p>否定:<span id="conUsername"></span><span id="conUserStatus">入室</span></p>

           <p><button id="prepare" class="btn-default">準備</button></p>
       </div>
   </div>

    <div class="row">
        <div  class="col-md-6">
            <div id="left">

                    <div class="top" style="display:none">
                    <div class="alert alert-info proState" role="alert" >
                      <p>オリジナル意見</p>
                    <span class="alert-link">
                    私は学生さんが成人したら経済的に独立するべきだと思います.なぜかというと，コンビニやレストランなどいろいろなアルバイトが学生さんに提供されています．
                    そのようなアルバイトをすれば生活費を自分で稼げると思います．
                    </span>
                    </div>

                    <div class="alert alert-success conDState" role="alert">
                        <p>異議説明</p>
                    <span class="alert-link">
                    私はアルバイトで生活費を稼げるとは思わないです．たくさんの国ではアルバイトの時給は一つのハンバーガーさえ買えないし，その時給で生活費を支えたければ，社会人と同じように頑張らないといけないです，だから全世界を見れば，アルバイトで生活費を
                    稼ぐことなんて理想的すぎるのではないでしょうか
                    </span>
                    </div>

                    <div class="alert alert-success conState" role="alert">
                        <p>オリジナル意見</p>
                    <span class="alert-link">
                    またアルバイトすることは勉強に悪い影響を及ぼすことがあります．時間は無限ではないので，学生はアルバイトばかりしていると，勉強時間を確保できず，学業が疎かになる恐れがあります．
                    </span>
                    </div>

                    <div class="alert alert-info proDState" role="alert">
                        <p>異議説明</p>
                    <span class="alert-link">
                        私はアルバイトをすることは勉強に悪い影響はないと思う．勉強に使える時間が限られていれば，効率的に使えるように頑張る．効率が上がれば，学習効果もかえって上がる
                        </span>
                    </div>

                    </div>

                    <div class="bottom">

                    </div>


                    <!--
                    <div class="alert alert-info proState" role="alert">
                        <p>オリジナル意見</p>
                    <span class="alert-link">
                        またアルバイトによっていろいろ勉強できる．それらは学校の勉強にも役に立つ．アルバイトで周りのものを見たり考えたりすることができる．アルバイトで得られる観察力，考え力のような力は学校での勉強にも役に立つのではないでしょうか．
                    </span>
                    </div>
                    -->

            </div>

            <div id="currentTitle">
<!--
                <div class="panel panel-default">
                    <div class="panel-heading">相手の意見</div>
                    <div class="panel-body">
                        私はアルバイトをすることは勉強に悪い影響はないと思う．勉強に使える時間が限られていれば，効率的に使えるように頑張る．効率が上がれば，学習効果もかえって上がる
                        \n
                        またアルバイトによっていろいろ勉強できる．それらは学校の勉強にも役に立つ．アルバイトで周りのものを見たり考えたりすることができる．アルバイトで得られる観察力，考え力のような力は学校での勉強にも役に立つのではないでしょうか．

                    </div>
                </div>
-->
            </div>

        </div>

        <div id="right" class="col-md-6">
        <div>

            <div class="row">
                <div class="col-md-2">
                    <p style="font-size: 13px;">参加者Pro</p>
                    <div class="dmcc"></div>
                </div>
                <div class="col-md-8"></div>
                <div class="col-md-2 text-right">
                    <p style="font-size: 13px;">参加者Con</p>
                    <div class="dmcc"></div>
                </div>
            </div>


<!--
            <div class="row resultPro">
            <div class="row">

                <div class="col-md-2">
                    <div class="dmcl"></div>
                </div>

                <div style="margin-top: 20px;" class="col-md-8">

                        <div class="panel panel-info ">
                            <div class="panel-heading">オリジナル意見</div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        主張
                                    </div>
                                    <div class="col-md-8">
                                         学生さんが成人したら経済的に独立するべき
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-1"></div>
                                    <div class="col-md-3">
                                        論拠
                                    </div>
                                    <div class="col-md-8">
                                        アルバイト代で生活を支えられる
                                        <span class="glyphicon glyphicon-question-sign"></span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-2"></div>
                                    <div class="col-md-2">
                                        根拠
                                    </div>
                                    <div class="col-md-8">
                                       コンビニやレストランなどいろいろアルバイトの機会を学生さんい提供されている
                                    </div>
                                </div>
                            </div>
                        </div>

                </div>

                <div class="col-md-2" >

                </div>

            </div>
            </div>

            <div class="row resultDCon">
            <div class="row">

                <div class="col-md-2">

                </div>

                <div style="margin-top: 20px;" class="col-md-8">

                    <div class="panel panel-success">

                        <div class="panel-heading">異議説明</div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-4">
                                    主張
                                </div>
                                <div class="col-md-8">
                                    その給料で生活を支えてられない
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-1"></div>
                                <div class="col-md-3">
                                    論拠
                                </div>
                                <div class="col-md-8">
                                    その給料で生活費を稼ぐには社会人と同じように頑張らなければならず，学生の場合は無理です．
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2"></div>
                                <div class="col-md-2">
                                    根拠
                                </div>
                                <div class="col-md-8">
                                    たくさんの国の時給では一つのハンバーガーさえ買えない
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="col-md-2" >
                    <div class="dmcr"></div>
                </div>

            </div>
            </div>

            <div class="row resultCon">
            <div class="row">

                <div class="col-md-2">

                </div>

                <div style="margin-top: 20px;" class="col-md-8">

                    <div class="panel panel-success ">

                        <div class="panel-heading">オリジナル意見</div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-4">
                                    主張
                                </div>
                                <div class="col-md-8">
                                    アルバイトは学業に悪い影響がある
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-1"></div>
                                <div class="col-md-3">
                                    論拠
                                </div>
                                <div class="col-md-8">
                                    <span class="glyphicon glyphicon-question-sign"></span>
                                    勉強用の時間が確保できないと，学業が疎かになる恐れがある
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2"></div>
                                <div class="col-md-2">
                                    根拠
                                </div>
                                <div class="col-md-8">
                                    あまりアルバイトをすると勉強用時間を確保できない
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="col-md-2" >
                    <div class="dmcr"></div>
                </div>

            </div>
            </div>

-->


        </div>
        </div>

    </div>

    <div class="row" id="proAnalysis">


    </div>

    <div class="row">

        <form class="form-group" id="form1" style="display:none">
            <hr>

            <div class="top" style="display:none">

            <div class="proDB">
                <div>
                <button class="btn btn-info" type="button">
                    異議説明 <span class="badge"></span>
                </button>
                </div>
            </div>

            <div class="proB">
                <div>
                <button  class="btn btn-info" type="button">
                    オリジナル意見 <span class="badge"></span>
                </button>
                </div>
            </div>

            <div class="conDB">
                <div>
                <button class="btn btn-success" type="button">
                    異議説明 <span class="badge"></span>
                </button>
                </div>
            </div>

            <div class="conB">
                <div>
                <button  class="btn btn-success" type="button">
                    オリジナル意見 <span class="badge"></span>
                </button>
                </div>
            </div>

            <div class="claim">

                            <div class="row">
                                <div class="col-sm-10">
                                    <div class="input-group">
                                        <span class="input-group-addon">主張: </span>
                                        <input type="text" class="form-control claimTxt" value="勉強用の時間が減少しても，学業が疎かにならない" placeholder="">
                                        <span class="input-group-addon"><input value="1" type="checkbox"> 異議つけ</span>
                                    </div>
                                </div>
                                <div class="col-sm-1 col-sm-offset-0 remove">
                                    <button class="btn btn-default btn-xm glyphicon glyphicon-ban-circle" onclick="return _remove(this)"></button>
                                </div>
                            </div>

                            <div class="warrant">

                                <div class="row">
                                    <div class="col-sm-offset-0 col-sm-1">
                                        <button class="btn btn-default btn-xs addClaim" onclick="return addClaim(this)"><i class="fa fa-plus-square"></i> 主張</button>
                                    </div>

                                    <div class="col-sm-9 col-sm-offset-0">
                                        <div class="input-group">
                                            <span class="input-group-addon">論拠: </span>
                                            <input type="text" class="form-control warrantTxt" value="大切にするから，時間の効率がよくなって，勉強の効果も上がる" placeholder="">
                                            <span class="input-group-addon"><input value="1" type="checkbox"> 異議つけ</span>
                                        </div>
                                    </div>

                                    <div class="col-sm-1 col-sm-offset-0 remove">
                                        <button class="btn btn-default btn-xm glyphicon glyphicon-ban-circle" onclick="return _remove(this)"></button>
                                    </div>

                                </div>


                                <div class="evidence">
                                    <div class="row">
                                        <div class="col-sm-offset-1 col-sm-1">
                                            <button class="btn btn-default btn-xs addWarrant" onclick="return addWarrant(this)"><i class="fa fa-plus-square"></i> 論拠</button>
                                        </div>
                                        <div class="col-sm-8 col-sm-offset-0">
                                            <div class="input-group">
                                                <span class="input-group-addon">根拠:</span>
                                                <input type="text" class="form-control evidenceTxt" value="勉強用の時間が少なければ，その時間を大切することになる" placeholder="">
                                                <span class="input-group-addon"><input value="1" type="checkbox"> 異議つけ</span>
                                            </div>
                                        </div>
                                        <div class="col-sm-1 col-sm-offset-0 remove">
                                            <button class="btn btn-default btn-xm glyphicon glyphicon-ban-circle" onclick="return _remove(this)"></button>
                                        </div>
                                    </div>
                                </div><!-- end of evidence-->




                                <div class="row">
                                    <div class="col-sm-offset-2 col-sm-1">
                                        <button class="btn btn-default btn-xs addEvidence" onclick="return addEvidence(this)"><span class="fa fa-plus-square"></span> 根拠</button>
                                    </div>
                                </div>

                            </div><!-- end of warrant-->

            </div><!-- end of claim-->



            </div>

            <div class="down">


            </div>

            <div class="row">
                <div class="col-sm-offset-4 col-sm-1">
                    <button type="button" class="btn btn-default" onclick="return _submit()" style="width:250px;">登録</button>
                </div>
            </div>

        </form>

    </div>

    <div class="row">

        <form id="form2" style="display:none">
            <div class="row" id="area">

            </div>
            <div class="row pull-right">
                <button type="submit" onclick="return __submit()" class="btn btn-default">Submit</button>
            </div>

        </form>

    </div>
    <br/>
    <div class="row" id="wait" style="display:none">
        <h2 class="alert alert-default text-center" role="alert">相手の確認をお待ちください</h2>
        <div class="cssload-loading">
            <div class="cssload-finger cssload-finger-1">
                <div class="cssload-finger-item">
                    <span></span><i></i>
                </div>
            </div>
            <div class="cssload-finger cssload-finger-2">
                <div class="cssload-finger-item">
                    <span></span><i></i>
                </div>
            </div>
            <div class="cssload-finger cssload-finger-3">
                <div class="cssload-finger-item">
                    <span></span><i></i>
                </div>
            </div>
            <div class="cssload-finger cssload-finger-4">
                <div class="cssload-finger-item">
                    <span></span><i></i>
                </div>
            </div>
            <div class="cssload-last-finger">
                <div class="cssload-last-finger-item"><i></i></div>
            </div>
        </div>

    </div>
</div>



<div class="row dissentStatement" style="display:none">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">

                <a class="navbar-brand" href="#">異議説明:&nbsp;<span class="stateContent"></span></a>
            </div>
        </div><!-- /.container-fluid -->
    </nav>
    <textarea class="form-control" rows="3"></textarea>
</div>


<div class="row originalStatement" style="display:none">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">

                <a class="navbar-brand" href="#">オリジナル意見</a>
            </div>
        </div><!-- /.container-fluid -->
    </nav>
    <textarea class="form-control" rows="3"></textarea>
</div>


<div id="copy" style="display:none">

    <div class="row resultDPro">
        <div class="row">

            <div class="col-md-2">
                <div class="dmcl"></div>
            </div>

            <div style="margin-top: 20px;" class="col-md-8">

                <div class="panel panel-info ">

                    <div class="panel-heading">異議説明</div>
                    <div class="panel-body">
                        <div class="resultDProA1">


                        </div>

                        <div class="resultDProA2" style="display:none">
                        <div class="row">
                            <div class="col-md-4">
                                主張
                            </div>
                            <div class="col-md-8">
                                勉強用の時間が減少しても，学業が疎かにならない
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-1">
                            </div>
                            <div class="col-md-3">
                                論拠
                            </div>
                            <div class="col-md-8">
                                大切にするから，時間の効率がよくなって，勉強の効果も上がる
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                            </div>
                            <div class="col-md-2">
                                根拠
                            </div>
                            <div class="col-md-8">
                                勉強用の時間が少なければ，その時間を大切することになる
                            </div>
                        </div>
                        </div>


                    </div>
                </div>

            </div>

            <div class="col-md-2" >

            </div>

        </div>
    </div>

    <div class="row resultPro">
        <div class="row">

            <div class="col-md-2">
                <div class="dmcl"></div>
            </div>

            <div style="margin-top: 20px;" class="col-md-8">

                <div class="panel panel-info">

                    <div class="panel-heading">オリジナル意見</div>
                    <div class="panel-body">

                        <div class="resultProA1"></div>
                        <div class="resultProA2" style="display:none">
                        <div class="row">
                            <div class="col-md-4">
                                主張
                            </div>
                            <div class="col-md-8">
                                アルバイトを通じて勉強もできる
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-1">
                            </div>
                            <div class="col-md-3">
                                論拠
                            </div>
                            <div class="col-md-8">
                                　アルバイトで得られた観察力，考え力のような力は学校での勉強も役たつのではないでしょうか
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                            </div>
                            <div class="col-md-2">
                                根拠
                            </div>
                            <div class="col-md-8">
                                周りのものを見たり，考えたりすることができる
                            </div>
                        </div>
                        </div>

                    </div>
                </div>

            </div>

            <div class="col-md-2" >

            </div>

        </div>
    </div>


    <div class="row resultCon">
            <div class="row">

                <div class="col-md-2">
                    <div class="dmcl"></div>
                </div>

                <div style="margin-top: 20px;" class="col-md-8">

                    <div class="panel panel-success">

                        <div class="panel-heading">オリジナル意見</div>
                        <div class="panel-body">

                            <div class="resultConA1"></div>
                            <div class="resultConA2" style="display:none">
                            <div class="row">
                                <div class="col-md-4">
                                    主張
                                </div>
                                <div class="col-md-8">
                                    アルバイトを通じて勉強もできる
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-1">
                                </div>
                                <div class="col-md-3">
                                    論拠
                                </div>
                                <div class="col-md-8">
                                    　アルバイトで得られた観察力，考え力のような力は学校での勉強も役たつのではないでしょうか
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2">
                                </div>
                                <div class="col-md-2">
                                    根拠
                                </div>
                                <div class="col-md-8">
                                    周りのものを見たり，考えたりすることができる
                                </div>
                            </div>
                            </div>

                        </div>
                    </div>

                </div>

                <div class="col-md-2" >

                </div>

            </div>
        </div>

        <div class="row resultDCon">
                    <div class="row">

                        <div class="col-md-2">
                            <div class="dmcl"></div>
                        </div>

                        <div style="margin-top: 20px;" class="col-md-8">

                            <div class="panel panel-success">

                                <div class="panel-heading">意義説明</div>
                             div class="panel-body">

                                    <div class="resultDConA1"></div>
                                    <div class="resultDConA2" style="display:none">
                                    <div class="row">
                                        <div class="col-md-4">
                                            主張
                                        </div>
                                        <div class="col-md-8">
                                            アルバイトを通じて勉強もできる
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-md-1">
                                        </div>
                                        <div class="col-md-3">
                                            論拠
                                        </div>
                                        <div class="col-md-8">
                                            　アルバイトで得られた観察力，考え力のような力は学校での勉強も役たつのではないでしょうか
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-2">
                                        </div>
                                        <div class="col-md-2">
                                            根拠
                                        </div>
                                        <div class="col-md-8">
                                            周りのものを見たり，考えたりすることができる
                                        </div>
                                    </div>
                                    </div>

                                </div>
                            </div>

                        </div>

                        <div class="col-md-2" >

                        </div>

                    </div>
                </div>

</div>
</body>
<script src="/socket.io/socket.io.js"></script>


<script>
var socket = io();



socket.on("enterRoom",function(msg){

    if(msg.loginInfo.position == 1){
        $("#proUsername").text(msg.loginInfo.username)
    }else{
        $("#conUsername").text(msg.loginInfo.username)
    }


})

socket.on("prepare",function(msg){
    console.log(msg.prepareInfo);

        if(msg.prepareInfo.position == 1){
            $("#proUserStatus").text("準備中")
        }else{
            $("#conUserStatus").text("準備中")
        }
})


socket.on("allPrepare",function(msg){
        var status = msg.status
        window.status = parseInt(status);

        if(status == 0){

                $("#nowStatus").text("肯定側意見を述べる")
                    //pro 做陈述
                    if($("#tachiba").attr("tachiba") == 1){
                            showNextStep()
                    }

        }
})

socket.on("receiveStatement",function(msg){

    // 0 pro 做陈述
    // 1 con 做分析
    // 2 con 做陈述
    // 3 pro 做分析

//submitContentArr


    window.status = msg.status


    if(window.status == 1){

         // 0 pro 做陈述
        var sampleProState = $("#left").find(".top").eq(0).find(".proState").eq(0).prop('outerHTML');
        var sampleProDState = $("#left").find(".top").eq(0).find(".proDState").eq(0).prop('outerHTML');

        $("#left").find(".bottom").eq(0).append(sampleProState)
        $("#left").find(".bottom").eq(0).find(".proState").eq(-1).find(".alert-link").eq(0).text(msg.submitContentArr[msg.submitContentArr.length-1].content)

                if(msg.submitContentArr.length>1){
                        for(var i=0;i<msg.submitContentArr.length-1;i++){
                                $("#left").find(".bottom").eq(0).find(".proState").eq(-1).before(sampleProDState)
                                $("#left").find(".bottom").eq(0).find(".proDState").eq(-1).find(".alert-link").eq(0).text(msg.submitContentArr[i].content)
                        }
                }

    }else{
        // 2 con 做陈述
        var sampleConState = $("#left").find(".top").eq(0).find(".conState").eq(0).prop('outerHTML');
        var sampleConDState = $("#left").find(".top").eq(0).find(".conDState").eq(0).prop('outerHTML');
        $("#left").find(".bottom").eq(0).append(sampleConState)
        $("#left").find(".bottom").eq(0).find(".conState").eq(-1).find(".alert-link").eq(0).text(msg.submitContentArr[msg.submitContentArr.length-1].content)

        if(msg.submitContentArr.length>1){
                for(var i=0;i<msg.submitContentArr.length-1;i++){
                        $("#left").find(".bottom").eq(0).find(".conState").eq(-1).before(sampleConDState)
                        $("#left").find(".bottom").eq(0).find(".conDState").eq(-1).find(".alert-link").eq(0).text(msg.submitContentArr[i].content)
                }
        }
    }

})




socket.on("DoAnalysis",function(msg){


    // 0 pro 做陈述
    // 1 con 做分析
    // 2 con 做陈述
    // 3 pro 做分析


    window.status = msg.status
    boundaryN = msg.submitContentArr.length>1?msg.submitContentArr.length-1:0

    var tachiba = $("#tachiba").attr("tachiba")


    // status=1
            // tachiba=1
                        //pro自己做完陈述,pro自己这边显示等待con分析

            // tachiba=2
                        //pro那边传来陈述,con这边根据陈述的内容结构(original 1个 意義説明 n个)作出分析输入框架的挂载


    // status=3
            // tachiba=1
                        //con那边传来陈述,pro这边根据陈述的内容结构(original 1个 意義説明 n个)作出分析输入框架的挂载

            // tachiba=2
                        //con自己做完陈述,con自己这边显示等待pro分析


    if(window.status==1){

            if(tachiba==1){
                                $("#wait").find("h2").eq(0).text("否定側の分析をお待ちください")
                                $("#wait").show()
            }else{
                                generateStatementInput(msg)
                                $("#wait").hide()
            }

    }else{


           if(tachiba==1){
                               generateStatementInput(msg)
                               $("#wait").hide()
           }else{
                                $("#wait").find("h2").eq(0).text("肯定側の分析をお待ちください")
                                $("#wait").show()
           }
    }



})


function generateStatementInput(msg){

    $("#form1").find(".down").eq(0).html("")

    if(msg.submitContentArr.length>1){


            //说明对方还有意義説明
                for(var i=0;i<msg.submitContentArr.length-1;i++){
                   //绑带告诉你现在是第几个意義説明
                   if(window.status==3){
                            var obj = $("#form1").find(".top").eq(0).find(".conDB").eq(0).children("div").eq(0)
                   }else{
                            var obj = $("#form1").find(".top").eq(0).find(".proDB").eq(0).children("div").eq(0)
                   }


                    //先编号
                    obj.attr("id","g"+i)

                    obj.find(".badge").eq(0).text(i+1)
                    $("#form1").find(".down").eq(0).append(obj.prop('outerHTML'))

                    //再把编号里的id删掉，不然会有重复
                    obj.removeAttr("id")

                    //对每一个意義説明挂一个分析模型
                    var obj = $("#form1").find(".top").eq(0).find(".claim").eq(0)
                    $("#form1").find(".down").eq(0).append(obj.prop('outerHTML'))

                }


                    //绑带告诉你现在是original陈述

                    if(window.status == 1){
                            var obj = $("#form1").find(".top").eq(0).find(".proB").eq(0).children("div").eq(0)
                    }else{
                            var obj = $("#form1").find(".top").eq(0).find(".conB").eq(0).children("div").eq(0)
                    }

                    obj.attr("id","c0")
                    $("#form1").find(".down").eq(0).append(obj.prop('outerHTML'))

                    //对每一个original陈述挂一个分析模型
                    var obj = $("#form1").find(".top").eq(0).find(".claim").eq(0)
                    $("#form1").find(".down").eq(0).append(obj.prop('outerHTML'))


        }else{

            //这是一个全局变量
            //boundaryN代表.claim的前多少位是異議説明,这里的boundaryN为0,因为只有originalstatment没有意義説明
            //说明对方只有original陈述

                //绑带告诉你现在是original陈述
                    if(window.status == 1){
                        var obj = $("#form1").find(".top").eq(0).find(".proB").eq(0).children("div").eq(0)
                    }else{
                        var obj = $("#form1").find(".top").eq(0).find(".conB").eq(0).children("div").eq(0)
                    }

                    obj.attr("id","c0")
                    $("#form1").find(".down").eq(0).append(obj.prop('outerHTML'))

                    //对每一个original陈述挂一个分析模型
                    var obj = $("#form1").find(".top").eq(0).find(".claim").eq(0)
                    $("#form1").find(".down").eq(0).append(obj.prop('outerHTML'))

        }


        $("#form1").show()
}

socket.on("receiveAnalysis",function(msg){

    _obj = msg._obj
    dissentObj = msg.dissentObj

    var _str = '';
    for(var i=0;i<_obj.length;i++){

    if(i<boundaryN){
    //如果是对前几位異議説明的分析的话
    _str += "<div class='row'>異議説明分"+(i+1)+"分析結果</div>"
    }else{
    //如果是对后几位オリジナル意見的分析的话
    _str += "<div class='row'>オリジナル意見分析結果</div>"
    }

    var claimDissentStr = parseInt(dissentObj[i]['claimDissent'])==1?"異議":"&nbsp;"


    //这里拼接的字符串是再提交完分析表单后呈现在分析表单上面的分析结果
    _str += '<div id="claimSample">'+
    '<div class="row">'+
    '<div class="col-sm-1">'+
    '主張'+
    '</div>'+
    '<div class="col-sm-8">'+ _obj[i].claimTxt+
    '</div><div class="col-sm-2">'+claimDissentStr+'</div>'+
    '</div>'

    for(var j=0;j<_obj[i]['warrant'].length;j++){
    var warrantDissentStr = parseInt(dissentObj[i]['warrant'][j]['warrantDissent'])==1?"異議":"&nbsp;"
    _str += '<div id="warrantSample">'+
    '<div class="row">'+
    '<div class="col-sm-1">'+
    '論拠'+
    '</div>'+
    '<div class="col-sm-7">'+_obj[i]['warrant'][j]['warrantTxt']+
    '</div><div class="col-sm-3">'+warrantDissentStr+'</div>'+
    '</div>'


    for(var k=0;k<_obj[i]['warrant'][j]['evidence'].length;k++){
    var evidenceDissentStr = parseInt(dissentObj[i]['warrant'][j]['evidenceDissent'][k])==1?"異議":"&nbsp;"
    _str +=   '<div id="evidenceSample">'+
    '<div class="row">'+
    '<div class="col-sm-1">'+
    '根拠'+
    '</div>'+
    '<div class="col-sm-6">'+_obj[i]['warrant'][j]['evidence'][k]['evidenceTxt']+
    '</div><div class="col-sm-4">'+evidenceDissentStr+'</div>'+
    '</div>'+
    '</div><!-- evidenceSample -->'
    }

    _str += '</div><!-- warrantSample  -->'
    }

    _str += '</div><!-- claimSample -->'
    }


    $("#proAnalysis").html(_str);

    if(window.status == 1){

    //如果这是con做分析的后发送给各方的结果的话

        if($("#tachiba").attr("tachiba") == 2){

            //如果是con -->右上角显示 上方显示结果 等待pro确认 之后显示statement文本输入框

            $("#wait").find("h2").eq(0).text("肯定側の確認をお待ちください")
            $("#wait").show()

                //在此模拟自己的意见经由对方审核同意
                setTimeout(function(){
                addResultToRightMapBox(msg.fenduanArr)
                showNextStep();
                },3000)

        }else{
            //如果是pro -->右上角显示 上方显示结果 等待自己确认后 显示等待con statement

            $("#wait").find("h2").eq(0).text("結果を確認してください")
            $("#wait").show()

                //在此模拟自己的意见经由对方审核同意
                setTimeout(function(){
                addResultToRightMapBox(msg.fenduanArr)
                },3000)

            $("#wait").find("h2").eq(0).text("否定側の意見述べまた意義説明をおまちください")
            $("#wait").show()


        }



    }

    if(window.status == 3){

        //如果这是pro做分析后发送给各方的结果的话

         if($("#tachiba").attr("tachiba") == 2){

            //如果是con -->右上角显示 上方显示结果 等待自己确认后 显示等待pro statement
            $("#wait").find("h2").eq(0).text("結果を確認してください")
            $("#wait").show()

                //在此模拟自己的意见经由对方审核同意
                setTimeout(function(){
                addResultToRightMapBox(msg.fenduanArr)
                },3000)

            $("#wait").find("h2").eq(0).text("肯定側の意見述べまた意義説明をおまちください")
            $("#wait").show()

         }else{
            //如果是pro -->右上角显示 上方显示结果 等待对方确认后 之后显示statement文本输入框
            $("#wait").find("h2").eq(0).text("否定側の確認をお待ちください")
            $("#wait").show()

                //在此模拟自己的意见经由对方审核同意
                setTimeout(function(){
                addResultToRightMapBox(msg.fenduanArr)
                showNextStep();
                },3000)
         }

    }


    $("#form1").hide()


    window.status = msg.status

    return false;

})


</script>


<script>

socket.emit("enterRoom",{})

$("#prepare").click(function(){

    $(this).attr("disabled","disabled");

        $.ajax({
           type: "POST",
           url: "/debate/preparePost",
           data: {},
           success: function(res){
                var result = eval("("+res+")")
                if(result.error==0){
                    socket.emit("prepare",{})
                }
           }
         });
})



function __submit(){
    var obj = $("#form2").find("#area").find("textarea");

    var submitContentArr = []

    for(var i=0;i<obj.length;i++){
           submitContentArr.push({content:obj.eq(i).val()})
    }

    socket.emit("makeStatement",{submitContentArr:submitContentArr})

    //隐藏陈述文本输入框
    $("#form2").hide()
    return false;
}

</script>

<script src="./global.js"></script>

</html>